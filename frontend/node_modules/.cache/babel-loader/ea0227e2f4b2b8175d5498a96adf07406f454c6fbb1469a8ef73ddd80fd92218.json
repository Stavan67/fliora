{"ast":null,"code":"var _jsxFileName = \"E:\\\\fliora\\\\fliora\\\\frontend\\\\src\\\\components\\\\room\\\\Room.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate, useLocation, useSearchParams } from 'react-router-dom';\nimport apiClient from '../../services/apiClient';\nimport webRTCService from '../../services/WebRTCService';\nimport { Client } from '@stomp/stompjs';\nimport SockJS from 'sockjs-client';\nimport VideoGrid from './VideoGrid';\nimport RoomControls from './RoomControls';\nimport RoomSidebar from './RoomSidebar';\nimport '../../styles/Room.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Room = ({\n  user,\n  onLogout\n}) => {\n  _s();\n  const [roomData, setRoomData] = useState(null);\n  const [isHost, setIsHost] = useState(false);\n  const [participants, setParticipants] = useState([]);\n  const [remoteStreams, setRemoteStreams] = useState(new Map());\n  const [localStream, setLocalStream] = useState(null);\n  const [videoEnabled, setVideoEnabled] = useState(true);\n  const [audioEnabled, setAudioEnabled] = useState(true);\n  const [chatMessages, setChatMessages] = useState([]);\n  const [chatInput, setChatInput] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [stompClient, setStompClient] = useState(null);\n  const [webRTCReady, setWebRTCReady] = useState(false);\n  const navigate = useNavigate();\n  const location = useLocation();\n  const [searchParams] = useSearchParams();\n  const initializationRef = useRef(false);\n  const videoStreamRef = useRef(null);\n  const participantsRef = useRef([]);\n  const roomDataRef = useRef(null); // Add ref to track roomData\n\n  useEffect(() => {\n    participantsRef.current = participants;\n  }, [participants]);\n\n  // Update roomDataRef whenever roomData changes\n  useEffect(() => {\n    roomDataRef.current = roomData;\n  }, [roomData]);\n  useEffect(() => {\n    var _location$state, _location$state2;\n    const roomCode = searchParams.get('room');\n    if (roomCode && !initializationRef.current && user) {\n      initializationRef.current = true;\n      joinRoomByCode(roomCode);\n      return;\n    }\n    if (!((_location$state = location.state) !== null && _location$state !== void 0 && _location$state.roomData) && !initializationRef.current && !roomCode) {\n      navigate('/dashboard');\n      return;\n    }\n    if ((_location$state2 = location.state) !== null && _location$state2 !== void 0 && _location$state2.roomData && !initializationRef.current) {\n      initializationRef.current = true;\n      const room = location.state.roomData;\n      setRoomData(room);\n      setIsHost(room.isHost);\n      initializeRoom(room);\n    }\n    return () => {\n      cleanup();\n    };\n  }, [location.state, searchParams, user]);\n  useEffect(() => {\n    console.log('[Room] Current participants:', participants.map(p => ({\n      id: p.id,\n      username: p.username\n    })));\n    console.log('[Room] Remote streams keys:', Array.from(remoteStreams.keys()));\n    console.log('[Room] Current user ID:', user.id);\n  }, [participants, remoteStreams, user]);\n  const joinRoomByCode = async roomCode => {\n    try {\n      setLoading(true);\n      console.log('[Room] ðŸŽ¯ Joining room by code:', roomCode);\n      const response = await apiClient.post(`/api/rooms/${roomCode}/join`);\n      const room = {\n        roomCode: response.data.roomCode,\n        roomName: response.data.roomName,\n        isHost: response.data.isHost\n      };\n      console.log('[Room] âœ… Successfully joined room:', room);\n\n      // Set room data BEFORE initializing\n      setRoomData(room);\n      setIsHost(room.isHost);\n\n      // Now initialize with the room object\n      await initializeRoom(room);\n    } catch (err) {\n      var _err$response, _err$response$data;\n      console.error('Error joining room:', err);\n      setError(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || 'Failed to join room');\n      setTimeout(() => navigate('/dashboard'), 2000);\n    }\n  };\n  const initializeRoom = async room => {\n    try {\n      console.log('[Room] ðŸš€ Initializing room:', room.roomCode);\n\n      // Initialize media first\n      await initializeMedia();\n\n      // Load participants with the room code\n      await loadParticipants(room.roomCode);\n\n      // Connect websocket\n      await connectWebSocket(room);\n      addSystemMessage(`Welcome to ${room.roomName}!`);\n    } catch (err) {\n      console.error('Error initializing room:', err);\n      setError('Failed to initialize room');\n    } finally {\n      setLoading(false);\n    }\n  };\n  const initializeMedia = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          width: {\n            ideal: 1280\n          },\n          height: {\n            ideal: 720\n          },\n          facingMode: 'user'\n        },\n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true\n        }\n      });\n      videoStreamRef.current = stream;\n      setLocalStream(stream);\n      console.log('[Room] âœ… Media initialized successfully');\n    } catch (err) {\n      console.error('Error accessing media devices:', err);\n      setError('Failed to access camera/microphone. Please check permissions.');\n      throw err;\n    }\n  };\n  const connectWebSocket = room => {\n    return new Promise((resolve, reject) => {\n      const socket = new SockJS('/ws');\n      const client = new Client({\n        webSocketFactory: () => socket,\n        reconnectDelay: 5000,\n        heartbeatIncoming: 4000,\n        heartbeatOutgoing: 4000,\n        onConnect: () => {\n          console.log('[Room] ðŸ”Œ WebSocket connected');\n          client.subscribe(`/topic/room/${room.roomCode}`, message => {\n            handleRoomNotification(JSON.parse(message.body));\n          });\n          const currentStream = videoStreamRef.current || localStream;\n          webRTCService.initialize(client, room.roomCode, user.id, currentStream);\n          webRTCService.onRemoteStream = handleRemoteStream;\n          webRTCService.onParticipantLeft = handleRemoteParticipantLeft;\n          setStompClient(client);\n          setWebRTCReady(true);\n          setTimeout(() => {\n            console.log('[Room] ðŸ“£ Notifying join to room');\n            webRTCService.notifyJoin();\n          }, 500);\n          setTimeout(() => {\n            console.log('[Room] ðŸ” Checking for existing participants...');\n            const currentParticipants = participantsRef.current;\n            console.log('[Room] ðŸ“‹ Participants to connect to:', currentParticipants.map(p => `${p.username}(${p.id})`));\n            if (currentParticipants.length > 1) {\n              initiateConnectionsToExistingParticipants();\n            } else {\n              console.log('[Room] â„¹ï¸ No existing participants to connect to');\n            }\n          }, 2000);\n          resolve();\n        },\n        onDisconnect: () => {\n          console.log('[Room] ðŸ”Œ WebSocket disconnected');\n          setWebRTCReady(false);\n        },\n        onStompError: error => {\n          console.error('[Room] âŒ WebSocket error:', error);\n          reject(error);\n        }\n      });\n      client.activate();\n    });\n  };\n  const initiateConnectionsToExistingParticipants = () => {\n    const currentParticipants = participantsRef.current;\n    console.log('[Room] ðŸ” Checking for existing participants to connect to:', currentParticipants.map(p => `${p.id}:${p.username}`));\n    if (currentParticipants.length === 0) {\n      console.log('[Room] â„¹ï¸ No existing participants found');\n      return;\n    }\n    currentParticipants.forEach(participant => {\n      const participantIdStr = String(participant.id);\n      const currentUserIdStr = String(user.id);\n      if (participantIdStr !== currentUserIdStr) {\n        console.log('[Room] ðŸ”— Processing existing participant:', participant.username, '(', participantIdStr, ')');\n        webRTCService.createPeerConnection(participantIdStr).then(() => {\n          console.log('[Room] âœ… Peer connection created for existing participant:', participantIdStr);\n          if (webRTCService.shouldInitiateConnection(currentUserIdStr, participantIdStr)) {\n            console.log('[Room] ðŸŽ¯ I should initiate to:', participantIdStr);\n            setTimeout(() => {\n              console.log('[Room] ðŸš€ Creating offer to existing participant:', participantIdStr);\n              webRTCService.createOffer(participantIdStr);\n            }, 1200);\n          } else {\n            console.log('[Room] â³ They should initiate to me:', participantIdStr);\n          }\n        }).catch(error => {\n          console.error('[Room] âŒ Error creating peer connection for existing participant:', error);\n        });\n      }\n    });\n  };\n  const handleRoomNotification = async notification => {\n    const {\n      type,\n      message,\n      userId\n    } = notification;\n    console.log('[Room] ðŸ“¢ Room notification received:', type, 'userId:', userId, 'currentUser:', user.id);\n    switch (type) {\n      case 'USER_JOINED':\n        addSystemMessage(message);\n        const updatedParticipants = await refreshParticipants();\n        console.log('[Room] ðŸ“‹ Participants after refresh:', updatedParticipants.map(p => p.id));\n        if (userId && String(userId) !== String(user.id)) {\n          console.log('[Room] ðŸ”— New participant joined, setting up WebRTC:', userId);\n          if (webRTCReady) {\n            setTimeout(() => {\n              console.log('[Room] ðŸš€ Calling handleJoin for new participant:', userId);\n              webRTCService.handleJoin(userId);\n            }, 500);\n          } else {\n            console.warn('[Room] âš ï¸ WebRTC not ready yet, queueing connection');\n            setTimeout(() => {\n              if (webRTCReady) {\n                console.log('[Room] ðŸš€ WebRTC now ready, calling handleJoin:', userId);\n                webRTCService.handleJoin(userId);\n              }\n            }, 2000);\n          }\n        }\n        break;\n      case 'USER_LEFT':\n      case 'USER_KICKED':\n        await refreshParticipants();\n        addSystemMessage(message);\n        break;\n      case 'MEDIA_UPDATED':\n        await refreshParticipants();\n        break;\n      case 'ROOM_ENDED':\n        addSystemMessage(message);\n        setTimeout(() => goBackToDashboard(), 3000);\n        break;\n      default:\n        console.log('[Room] â“ Unknown notification type:', type);\n        break;\n    }\n  };\n  const handleRemoteStream = (participantId, stream) => {\n    const participantIdStr = String(participantId);\n    console.log('[Room] ðŸŽ¥ handleRemoteStream called for:', participantIdStr);\n    console.log('[Room] ðŸŽ¥ Stream tracks:', stream.getTracks().map(t => ({\n      kind: t.kind,\n      enabled: t.enabled\n    })));\n    console.log('[Room] ðŸŽ¥ Current participants:', participants.map(p => p.id));\n    const participantExists = participants.some(p => String(p.id) === participantIdStr);\n    console.log('[Room] ðŸŽ¥ Participant exists in list?', participantExists);\n    setRemoteStreams(prev => {\n      const newStreams = new Map(prev);\n      newStreams.set(participantIdStr, stream);\n      console.log('[Room] ðŸŽ¥ Updated remoteStreams, now has keys:', Array.from(newStreams.keys()));\n      return newStreams;\n    });\n  };\n  const handleRemoteParticipantLeft = participantId => {\n    console.log('[Room] ðŸ‘‹ Removing remote stream for participant:', participantId);\n    setRemoteStreams(prev => {\n      const newStreams = new Map(prev);\n      newStreams.delete(participantId);\n      return newStreams;\n    });\n  };\n  const loadParticipants = async roomCode => {\n    try {\n      console.log('[Room] ðŸ“‹ Loading participants for room:', roomCode);\n      const response = await apiClient.get(`/api/rooms/${roomCode}/participants`);\n      const loadedParticipants = response.data.participants;\n      console.log('[Room] âœ… Loaded participants:', loadedParticipants.map(p => ({\n        id: p.id,\n        username: p.username\n      })));\n      setParticipants(loadedParticipants);\n      return loadedParticipants;\n    } catch (err) {\n      console.error('[Room] âŒ Failed to load participants:', err);\n      return [];\n    }\n  };\n  const refreshParticipants = async () => {\n    // Use the ref to get the current roomData\n    const currentRoomData = roomDataRef.current;\n    if (currentRoomData && currentRoomData.roomCode) {\n      console.log('[Room] ðŸ”„ Refreshing participants for room:', currentRoomData.roomCode);\n      return await loadParticipants(currentRoomData.roomCode);\n    } else {\n      console.error('[Room] âŒ Cannot refresh participants: roomData not available');\n      return [];\n    }\n  };\n  const toggleVideo = async () => {\n    const newVideoState = !videoEnabled;\n    setVideoEnabled(newVideoState);\n    if (videoStreamRef.current) {\n      const videoTracks = videoStreamRef.current.getVideoTracks();\n      videoTracks.forEach(track => {\n        track.enabled = newVideoState;\n      });\n      webRTCService.toggleTrack('video', newVideoState);\n    }\n    try {\n      if (roomData && roomData.roomCode) {\n        await apiClient.post(`/api/rooms/${roomData.roomCode}/media`, {\n          videoEnabled: newVideoState,\n          audioEnabled: audioEnabled\n        });\n      }\n    } catch (err) {\n      console.error('Failed to update video status:', err);\n    }\n  };\n  const toggleAudio = async () => {\n    const newAudioState = !audioEnabled;\n    setAudioEnabled(newAudioState);\n    if (videoStreamRef.current) {\n      const audioTracks = videoStreamRef.current.getAudioTracks();\n      audioTracks.forEach(track => {\n        track.enabled = newAudioState;\n      });\n      webRTCService.toggleTrack('audio', newAudioState);\n    }\n    try {\n      if (roomData && roomData.roomCode) {\n        await apiClient.post(`/api/rooms/${roomData.roomCode}/media`, {\n          videoEnabled: videoEnabled,\n          audioEnabled: newAudioState\n        });\n      }\n    } catch (err) {\n      console.error('Failed to update audio status:', err);\n    }\n  };\n  const sendChatMessage = () => {\n    if (!chatInput.trim()) return;\n    const message = {\n      id: Date.now(),\n      type: 'user',\n      username: user.username,\n      message: chatInput,\n      timestamp: new Date().toLocaleTimeString()\n    };\n    setChatMessages(prev => [...prev, message]);\n    setChatInput('');\n  };\n  const addSystemMessage = message => {\n    setChatMessages(prev => [...prev, {\n      id: Date.now(),\n      type: 'system',\n      message,\n      timestamp: new Date().toLocaleTimeString()\n    }]);\n  };\n  const copyRoomLink = () => {\n    const link = `${window.location.origin}/?room=${roomData.roomCode}`;\n    navigator.clipboard.writeText(link);\n    alert('Room link copied to clipboard!');\n  };\n  const shareToWhatsApp = () => {\n    const link = `${window.location.origin}/?room=${roomData.roomCode}`;\n    const message = `Join my Fliora Watch Party!\\n\\nRoom Code: ${roomData.roomCode}\\n${link}`;\n    window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');\n  };\n  const handleStartWatchParty = async () => {\n    try {\n      setLoading(true);\n      if (roomData && roomData.roomCode) {\n        await apiClient.post(`/api/rooms/${roomData.roomCode}/start`);\n        addSystemMessage('Starting Watch Party...');\n      }\n    } catch (err) {\n      var _err$response2, _err$response2$data;\n      setError(((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.message) || 'Failed to start watch party');\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handleKickParticipant = async participantId => {\n    try {\n      if (roomData && roomData.roomCode) {\n        await apiClient.post(`/api/rooms/${roomData.roomCode}/kick/${participantId}`);\n      }\n    } catch (err) {\n      var _err$response3, _err$response3$data;\n      setError(((_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : (_err$response3$data = _err$response3.data) === null || _err$response3$data === void 0 ? void 0 : _err$response3$data.message) || 'Failed to kick participant');\n    }\n  };\n  const goBackToDashboard = async () => {\n    await cleanup();\n    navigate('/dashboard');\n  };\n  const cleanup = async () => {\n    console.log('[Room] ðŸ§¹ Starting cleanup');\n    if (videoStreamRef.current) {\n      videoStreamRef.current.getTracks().forEach(track => track.stop());\n      videoStreamRef.current = null;\n    }\n    if (localStream) {\n      localStream.getTracks().forEach(track => track.stop());\n    }\n    webRTCService.cleanup();\n    if (stompClient) {\n      stompClient.deactivate();\n    }\n\n    // Use ref for cleanup\n    const currentRoomData = roomDataRef.current;\n    if (currentRoomData && currentRoomData.roomCode) {\n      try {\n        await apiClient.post(`/api/rooms/${currentRoomData.roomCode}/leave`);\n      } catch (err) {\n        console.error('Failed to leave room:', err);\n      }\n    }\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"room-loading\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loading-spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 479,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Initializing room...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 480,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 478,\n      columnNumber: 13\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"room-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"nav\", {\n      className: \"room-navbar\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"navbar-brand\",\n        children: [\"Fliora - \", roomData === null || roomData === void 0 ? void 0 : roomData.roomName]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 488,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"navbar-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"room-code-display\",\n          children: [\"Room: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: roomData === null || roomData === void 0 ? void 0 : roomData.roomCode\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 493,\n            columnNumber: 31\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 492,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"participant-count\",\n          children: [participants.length, \" \", participants.length === 1 ? 'participant' : 'participants']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 495,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 491,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"navbar-actions\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"user-welcome\",\n          children: [\"Welcome, \", user === null || user === void 0 ? void 0 : user.username, \"!\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 500,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"leave-room-btn\",\n          onClick: goBackToDashboard,\n          children: \"Leave Room\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 501,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"logout-btn\",\n          onClick: onLogout,\n          children: \"Logout\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 504,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 499,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 487,\n      columnNumber: 13\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"room-error-message\",\n      children: [error, /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setError(''),\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 512,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 510,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"room-content\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"room-main\",\n        children: [/*#__PURE__*/_jsxDEV(VideoGrid, {\n          localStream: localStream,\n          remoteStreams: remoteStreams,\n          participants: participants,\n          currentUser: user,\n          videoEnabled: videoEnabled,\n          audioEnabled: audioEnabled,\n          isHost: isHost,\n          onKickParticipant: handleKickParticipant\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 517,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(RoomControls, {\n          videoEnabled: videoEnabled,\n          audioEnabled: audioEnabled,\n          onToggleVideo: toggleVideo,\n          onToggleAudio: toggleAudio,\n          isHost: isHost,\n          onStartWatchParty: handleStartWatchParty,\n          loading: loading\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 527,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 516,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(RoomSidebar, {\n        roomCode: roomData === null || roomData === void 0 ? void 0 : roomData.roomCode,\n        participants: participants,\n        chatMessages: chatMessages,\n        chatInput: chatInput,\n        onChatInputChange: setChatInput,\n        onSendMessage: sendChatMessage,\n        onCopyLink: copyRoomLink,\n        onShareWhatsApp: shareToWhatsApp\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 537,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 515,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 486,\n    columnNumber: 9\n  }, this);\n};\n_s(Room, \"bJ/7V8nqit2c666jU8rsKfghKRE=\", false, function () {\n  return [useNavigate, useLocation, useSearchParams];\n});\n_c = Room;\nexport default Room;\nvar _c;\n$RefreshReg$(_c, \"Room\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","useLocation","useSearchParams","apiClient","webRTCService","Client","SockJS","VideoGrid","RoomControls","RoomSidebar","jsxDEV","_jsxDEV","Room","user","onLogout","_s","roomData","setRoomData","isHost","setIsHost","participants","setParticipants","remoteStreams","setRemoteStreams","Map","localStream","setLocalStream","videoEnabled","setVideoEnabled","audioEnabled","setAudioEnabled","chatMessages","setChatMessages","chatInput","setChatInput","loading","setLoading","error","setError","stompClient","setStompClient","webRTCReady","setWebRTCReady","navigate","location","searchParams","initializationRef","videoStreamRef","participantsRef","roomDataRef","current","_location$state","_location$state2","roomCode","get","joinRoomByCode","state","room","initializeRoom","cleanup","console","log","map","p","id","username","Array","from","keys","response","post","data","roomName","err","_err$response","_err$response$data","message","setTimeout","initializeMedia","loadParticipants","connectWebSocket","addSystemMessage","stream","navigator","mediaDevices","getUserMedia","video","width","ideal","height","facingMode","audio","echoCancellation","noiseSuppression","autoGainControl","Promise","resolve","reject","socket","client","webSocketFactory","reconnectDelay","heartbeatIncoming","heartbeatOutgoing","onConnect","subscribe","handleRoomNotification","JSON","parse","body","currentStream","initialize","onRemoteStream","handleRemoteStream","onParticipantLeft","handleRemoteParticipantLeft","notifyJoin","currentParticipants","length","initiateConnectionsToExistingParticipants","onDisconnect","onStompError","activate","forEach","participant","participantIdStr","String","currentUserIdStr","createPeerConnection","then","shouldInitiateConnection","createOffer","catch","notification","type","userId","updatedParticipants","refreshParticipants","handleJoin","warn","goBackToDashboard","participantId","getTracks","t","kind","enabled","participantExists","some","prev","newStreams","set","delete","loadedParticipants","currentRoomData","toggleVideo","newVideoState","videoTracks","getVideoTracks","track","toggleTrack","toggleAudio","newAudioState","audioTracks","getAudioTracks","sendChatMessage","trim","Date","now","timestamp","toLocaleTimeString","copyRoomLink","link","window","origin","clipboard","writeText","alert","shareToWhatsApp","open","encodeURIComponent","handleStartWatchParty","_err$response2","_err$response2$data","handleKickParticipant","_err$response3","_err$response3$data","stop","deactivate","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","currentUser","onKickParticipant","onToggleVideo","onToggleAudio","onStartWatchParty","onChatInputChange","onSendMessage","onCopyLink","onShareWhatsApp","_c","$RefreshReg$"],"sources":["E:/fliora/fliora/frontend/src/components/room/Room.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useNavigate, useLocation, useSearchParams } from 'react-router-dom';\r\nimport apiClient from '../../services/apiClient';\r\nimport webRTCService from '../../services/WebRTCService';\r\nimport { Client } from '@stomp/stompjs';\r\nimport SockJS from 'sockjs-client';\r\nimport VideoGrid from './VideoGrid';\r\nimport RoomControls from './RoomControls';\r\nimport RoomSidebar from './RoomSidebar';\r\nimport '../../styles/Room.css';\r\n\r\nconst Room = ({ user, onLogout }) => {\r\n    const [roomData, setRoomData] = useState(null);\r\n    const [isHost, setIsHost] = useState(false);\r\n    const [participants, setParticipants] = useState([]);\r\n    const [remoteStreams, setRemoteStreams] = useState(new Map());\r\n    const [localStream, setLocalStream] = useState(null);\r\n    const [videoEnabled, setVideoEnabled] = useState(true);\r\n    const [audioEnabled, setAudioEnabled] = useState(true);\r\n    const [chatMessages, setChatMessages] = useState([]);\r\n    const [chatInput, setChatInput] = useState('');\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState('');\r\n    const [stompClient, setStompClient] = useState(null);\r\n    const [webRTCReady, setWebRTCReady] = useState(false);\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n    const [searchParams] = useSearchParams();\r\n    const initializationRef = useRef(false);\r\n    const videoStreamRef = useRef(null);\r\n    const participantsRef = useRef([]);\r\n    const roomDataRef = useRef(null); // Add ref to track roomData\r\n\r\n    useEffect(() => {\r\n        participantsRef.current = participants;\r\n    }, [participants]);\r\n\r\n    // Update roomDataRef whenever roomData changes\r\n    useEffect(() => {\r\n        roomDataRef.current = roomData;\r\n    }, [roomData]);\r\n\r\n    useEffect(() => {\r\n        const roomCode = searchParams.get('room');\r\n\r\n        if (roomCode && !initializationRef.current && user) {\r\n            initializationRef.current = true;\r\n            joinRoomByCode(roomCode);\r\n            return;\r\n        }\r\n\r\n        if (!location.state?.roomData && !initializationRef.current && !roomCode) {\r\n            navigate('/dashboard');\r\n            return;\r\n        }\r\n\r\n        if (location.state?.roomData && !initializationRef.current) {\r\n            initializationRef.current = true;\r\n            const room = location.state.roomData;\r\n            setRoomData(room);\r\n            setIsHost(room.isHost);\r\n            initializeRoom(room);\r\n        }\r\n\r\n        return () => {\r\n            cleanup();\r\n        };\r\n    }, [location.state, searchParams, user]);\r\n\r\n    useEffect(() => {\r\n        console.log('[Room] Current participants:', participants.map(p => ({ id: p.id, username: p.username })));\r\n        console.log('[Room] Remote streams keys:', Array.from(remoteStreams.keys()));\r\n        console.log('[Room] Current user ID:', user.id);\r\n    }, [participants, remoteStreams, user]);\r\n\r\n    const joinRoomByCode = async (roomCode) => {\r\n        try {\r\n            setLoading(true);\r\n            console.log('[Room] ðŸŽ¯ Joining room by code:', roomCode);\r\n\r\n            const response = await apiClient.post(`/api/rooms/${roomCode}/join`);\r\n            const room = {\r\n                roomCode: response.data.roomCode,\r\n                roomName: response.data.roomName,\r\n                isHost: response.data.isHost\r\n            };\r\n\r\n            console.log('[Room] âœ… Successfully joined room:', room);\r\n\r\n            // Set room data BEFORE initializing\r\n            setRoomData(room);\r\n            setIsHost(room.isHost);\r\n\r\n            // Now initialize with the room object\r\n            await initializeRoom(room);\r\n        } catch (err) {\r\n            console.error('Error joining room:', err);\r\n            setError(err.response?.data?.message || 'Failed to join room');\r\n            setTimeout(() => navigate('/dashboard'), 2000);\r\n        }\r\n    };\r\n\r\n    const initializeRoom = async (room) => {\r\n        try {\r\n            console.log('[Room] ðŸš€ Initializing room:', room.roomCode);\r\n\r\n            // Initialize media first\r\n            await initializeMedia();\r\n\r\n            // Load participants with the room code\r\n            await loadParticipants(room.roomCode);\r\n\r\n            // Connect websocket\r\n            await connectWebSocket(room);\r\n\r\n            addSystemMessage(`Welcome to ${room.roomName}!`);\r\n        } catch (err) {\r\n            console.error('Error initializing room:', err);\r\n            setError('Failed to initialize room');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const initializeMedia = async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({\r\n                video: {\r\n                    width: { ideal: 1280 },\r\n                    height: { ideal: 720 },\r\n                    facingMode: 'user'\r\n                },\r\n                audio: {\r\n                    echoCancellation: true,\r\n                    noiseSuppression: true,\r\n                    autoGainControl: true\r\n                }\r\n            });\r\n            videoStreamRef.current = stream;\r\n            setLocalStream(stream);\r\n            console.log('[Room] âœ… Media initialized successfully');\r\n        } catch (err) {\r\n            console.error('Error accessing media devices:', err);\r\n            setError('Failed to access camera/microphone. Please check permissions.');\r\n            throw err;\r\n        }\r\n    };\r\n\r\n    const connectWebSocket = (room) => {\r\n        return new Promise((resolve, reject) => {\r\n            const socket = new SockJS('/ws');\r\n            const client = new Client({\r\n                webSocketFactory: () => socket,\r\n                reconnectDelay: 5000,\r\n                heartbeatIncoming: 4000,\r\n                heartbeatOutgoing: 4000,\r\n                onConnect: () => {\r\n                    console.log('[Room] ðŸ”Œ WebSocket connected');\r\n                    client.subscribe(`/topic/room/${room.roomCode}`, (message) => {\r\n                        handleRoomNotification(JSON.parse(message.body));\r\n                    });\r\n\r\n                    const currentStream = videoStreamRef.current || localStream;\r\n                    webRTCService.initialize(client, room.roomCode, user.id, currentStream);\r\n                    webRTCService.onRemoteStream = handleRemoteStream;\r\n                    webRTCService.onParticipantLeft = handleRemoteParticipantLeft;\r\n\r\n                    setStompClient(client);\r\n                    setWebRTCReady(true);\r\n\r\n                    setTimeout(() => {\r\n                        console.log('[Room] ðŸ“£ Notifying join to room');\r\n                        webRTCService.notifyJoin();\r\n                    }, 500);\r\n\r\n                    setTimeout(() => {\r\n                        console.log('[Room] ðŸ” Checking for existing participants...');\r\n                        const currentParticipants = participantsRef.current;\r\n                        console.log('[Room] ðŸ“‹ Participants to connect to:',\r\n                            currentParticipants.map(p => `${p.username}(${p.id})`));\r\n                        if (currentParticipants.length > 1) {\r\n                            initiateConnectionsToExistingParticipants();\r\n                        } else {\r\n                            console.log('[Room] â„¹ï¸ No existing participants to connect to');\r\n                        }\r\n                    }, 2000);\r\n                    resolve();\r\n                },\r\n                onDisconnect: () => {\r\n                    console.log('[Room] ðŸ”Œ WebSocket disconnected');\r\n                    setWebRTCReady(false);\r\n                },\r\n                onStompError: (error) => {\r\n                    console.error('[Room] âŒ WebSocket error:', error);\r\n                    reject(error);\r\n                }\r\n            });\r\n            client.activate();\r\n        });\r\n    };\r\n\r\n    const initiateConnectionsToExistingParticipants = () => {\r\n        const currentParticipants = participantsRef.current;\r\n        console.log('[Room] ðŸ” Checking for existing participants to connect to:',\r\n            currentParticipants.map(p => `${p.id}:${p.username}`));\r\n\r\n        if (currentParticipants.length === 0) {\r\n            console.log('[Room] â„¹ï¸ No existing participants found');\r\n            return;\r\n        }\r\n\r\n        currentParticipants.forEach(participant => {\r\n            const participantIdStr = String(participant.id);\r\n            const currentUserIdStr = String(user.id);\r\n\r\n            if (participantIdStr !== currentUserIdStr) {\r\n                console.log('[Room] ðŸ”— Processing existing participant:',\r\n                    participant.username, '(', participantIdStr, ')');\r\n\r\n                webRTCService.createPeerConnection(participantIdStr).then(() => {\r\n                    console.log('[Room] âœ… Peer connection created for existing participant:', participantIdStr);\r\n\r\n                    if (webRTCService.shouldInitiateConnection(currentUserIdStr, participantIdStr)) {\r\n                        console.log('[Room] ðŸŽ¯ I should initiate to:', participantIdStr);\r\n                        setTimeout(() => {\r\n                            console.log('[Room] ðŸš€ Creating offer to existing participant:', participantIdStr);\r\n                            webRTCService.createOffer(participantIdStr);\r\n                        }, 1200);\r\n                    } else {\r\n                        console.log('[Room] â³ They should initiate to me:', participantIdStr);\r\n                    }\r\n                }).catch(error => {\r\n                    console.error('[Room] âŒ Error creating peer connection for existing participant:', error);\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleRoomNotification = async (notification) => {\r\n        const { type, message, userId } = notification;\r\n        console.log('[Room] ðŸ“¢ Room notification received:', type, 'userId:', userId, 'currentUser:', user.id);\r\n\r\n        switch (type) {\r\n            case 'USER_JOINED':\r\n                addSystemMessage(message);\r\n\r\n                const updatedParticipants = await refreshParticipants();\r\n                console.log('[Room] ðŸ“‹ Participants after refresh:', updatedParticipants.map(p => p.id));\r\n\r\n                if (userId && String(userId) !== String(user.id)) {\r\n                    console.log('[Room] ðŸ”— New participant joined, setting up WebRTC:', userId);\r\n\r\n                    if (webRTCReady) {\r\n                        setTimeout(() => {\r\n                            console.log('[Room] ðŸš€ Calling handleJoin for new participant:', userId);\r\n                            webRTCService.handleJoin(userId);\r\n                        }, 500);\r\n                    } else {\r\n                        console.warn('[Room] âš ï¸ WebRTC not ready yet, queueing connection');\r\n                        setTimeout(() => {\r\n                            if (webRTCReady) {\r\n                                console.log('[Room] ðŸš€ WebRTC now ready, calling handleJoin:', userId);\r\n                                webRTCService.handleJoin(userId);\r\n                            }\r\n                        }, 2000);\r\n                    }\r\n                }\r\n                break;\r\n            case 'USER_LEFT':\r\n            case 'USER_KICKED':\r\n                await refreshParticipants();\r\n                addSystemMessage(message);\r\n                break;\r\n            case 'MEDIA_UPDATED':\r\n                await refreshParticipants();\r\n                break;\r\n            case 'ROOM_ENDED':\r\n                addSystemMessage(message);\r\n                setTimeout(() => goBackToDashboard(), 3000);\r\n                break;\r\n            default:\r\n                console.log('[Room] â“ Unknown notification type:', type);\r\n                break;\r\n        }\r\n    };\r\n\r\n    const handleRemoteStream = (participantId, stream) => {\r\n        const participantIdStr = String(participantId);\r\n        console.log('[Room] ðŸŽ¥ handleRemoteStream called for:', participantIdStr);\r\n        console.log('[Room] ðŸŽ¥ Stream tracks:', stream.getTracks().map(t => ({ kind: t.kind, enabled: t.enabled })));\r\n        console.log('[Room] ðŸŽ¥ Current participants:', participants.map(p => p.id));\r\n\r\n        const participantExists = participants.some(p => String(p.id) === participantIdStr);\r\n        console.log('[Room] ðŸŽ¥ Participant exists in list?', participantExists);\r\n\r\n        setRemoteStreams(prev => {\r\n            const newStreams = new Map(prev);\r\n            newStreams.set(participantIdStr, stream);\r\n            console.log('[Room] ðŸŽ¥ Updated remoteStreams, now has keys:', Array.from(newStreams.keys()));\r\n            return newStreams;\r\n        });\r\n    };\r\n\r\n    const handleRemoteParticipantLeft = (participantId) => {\r\n        console.log('[Room] ðŸ‘‹ Removing remote stream for participant:', participantId);\r\n        setRemoteStreams(prev => {\r\n            const newStreams = new Map(prev);\r\n            newStreams.delete(participantId);\r\n            return newStreams;\r\n        });\r\n    };\r\n\r\n    const loadParticipants = async (roomCode) => {\r\n        try {\r\n            console.log('[Room] ðŸ“‹ Loading participants for room:', roomCode);\r\n            const response = await apiClient.get(`/api/rooms/${roomCode}/participants`);\r\n            const loadedParticipants = response.data.participants;\r\n            console.log('[Room] âœ… Loaded participants:', loadedParticipants.map(p => ({ id: p.id, username: p.username })));\r\n            setParticipants(loadedParticipants);\r\n            return loadedParticipants;\r\n        } catch (err) {\r\n            console.error('[Room] âŒ Failed to load participants:', err);\r\n            return [];\r\n        }\r\n    };\r\n\r\n    const refreshParticipants = async () => {\r\n        // Use the ref to get the current roomData\r\n        const currentRoomData = roomDataRef.current;\r\n        if (currentRoomData && currentRoomData.roomCode) {\r\n            console.log('[Room] ðŸ”„ Refreshing participants for room:', currentRoomData.roomCode);\r\n            return await loadParticipants(currentRoomData.roomCode);\r\n        } else {\r\n            console.error('[Room] âŒ Cannot refresh participants: roomData not available');\r\n            return [];\r\n        }\r\n    };\r\n\r\n    const toggleVideo = async () => {\r\n        const newVideoState = !videoEnabled;\r\n        setVideoEnabled(newVideoState);\r\n\r\n        if (videoStreamRef.current) {\r\n            const videoTracks = videoStreamRef.current.getVideoTracks();\r\n            videoTracks.forEach(track => {\r\n                track.enabled = newVideoState;\r\n            });\r\n            webRTCService.toggleTrack('video', newVideoState);\r\n        }\r\n\r\n        try {\r\n            if (roomData && roomData.roomCode) {\r\n                await apiClient.post(`/api/rooms/${roomData.roomCode}/media`, {\r\n                    videoEnabled: newVideoState,\r\n                    audioEnabled: audioEnabled\r\n                });\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to update video status:', err);\r\n        }\r\n    };\r\n\r\n    const toggleAudio = async () => {\r\n        const newAudioState = !audioEnabled;\r\n        setAudioEnabled(newAudioState);\r\n\r\n        if (videoStreamRef.current) {\r\n            const audioTracks = videoStreamRef.current.getAudioTracks();\r\n            audioTracks.forEach(track => {\r\n                track.enabled = newAudioState;\r\n            });\r\n            webRTCService.toggleTrack('audio', newAudioState);\r\n        }\r\n\r\n        try {\r\n            if (roomData && roomData.roomCode) {\r\n                await apiClient.post(`/api/rooms/${roomData.roomCode}/media`, {\r\n                    videoEnabled: videoEnabled,\r\n                    audioEnabled: newAudioState\r\n                });\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to update audio status:', err);\r\n        }\r\n    };\r\n\r\n    const sendChatMessage = () => {\r\n        if (!chatInput.trim()) return;\r\n\r\n        const message = {\r\n            id: Date.now(),\r\n            type: 'user',\r\n            username: user.username,\r\n            message: chatInput,\r\n            timestamp: new Date().toLocaleTimeString()\r\n        };\r\n        setChatMessages(prev => [...prev, message]);\r\n        setChatInput('');\r\n    };\r\n\r\n    const addSystemMessage = (message) => {\r\n        setChatMessages(prev => [...prev, {\r\n            id: Date.now(),\r\n            type: 'system',\r\n            message,\r\n            timestamp: new Date().toLocaleTimeString()\r\n        }]);\r\n    };\r\n\r\n    const copyRoomLink = () => {\r\n        const link = `${window.location.origin}/?room=${roomData.roomCode}`;\r\n        navigator.clipboard.writeText(link);\r\n        alert('Room link copied to clipboard!');\r\n    };\r\n\r\n    const shareToWhatsApp = () => {\r\n        const link = `${window.location.origin}/?room=${roomData.roomCode}`;\r\n        const message = `Join my Fliora Watch Party!\\n\\nRoom Code: ${roomData.roomCode}\\n${link}`;\r\n        window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');\r\n    };\r\n\r\n    const handleStartWatchParty = async () => {\r\n        try {\r\n            setLoading(true);\r\n            if (roomData && roomData.roomCode) {\r\n                await apiClient.post(`/api/rooms/${roomData.roomCode}/start`);\r\n                addSystemMessage('Starting Watch Party...');\r\n            }\r\n        } catch (err) {\r\n            setError(err.response?.data?.message || 'Failed to start watch party');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleKickParticipant = async (participantId) => {\r\n        try {\r\n            if (roomData && roomData.roomCode) {\r\n                await apiClient.post(`/api/rooms/${roomData.roomCode}/kick/${participantId}`);\r\n            }\r\n        } catch (err) {\r\n            setError(err.response?.data?.message || 'Failed to kick participant');\r\n        }\r\n    };\r\n\r\n    const goBackToDashboard = async () => {\r\n        await cleanup();\r\n        navigate('/dashboard');\r\n    };\r\n\r\n    const cleanup = async () => {\r\n        console.log('[Room] ðŸ§¹ Starting cleanup');\r\n        if (videoStreamRef.current) {\r\n            videoStreamRef.current.getTracks().forEach(track => track.stop());\r\n            videoStreamRef.current = null;\r\n        }\r\n        if (localStream) {\r\n            localStream.getTracks().forEach(track => track.stop());\r\n        }\r\n        webRTCService.cleanup();\r\n        if (stompClient) {\r\n            stompClient.deactivate();\r\n        }\r\n\r\n        // Use ref for cleanup\r\n        const currentRoomData = roomDataRef.current;\r\n        if (currentRoomData && currentRoomData.roomCode) {\r\n            try {\r\n                await apiClient.post(`/api/rooms/${currentRoomData.roomCode}/leave`);\r\n            } catch (err) {\r\n                console.error('Failed to leave room:', err);\r\n            }\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"room-loading\">\r\n                <div className=\"loading-spinner\"></div>\r\n                <p>Initializing room...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"room-container\">\r\n            <nav className=\"room-navbar\">\r\n                <div className=\"navbar-brand\">\r\n                    Fliora - {roomData?.roomName}\r\n                </div>\r\n                <div className=\"navbar-info\">\r\n                    <span className=\"room-code-display\">\r\n                        Room: <strong>{roomData?.roomCode}</strong>\r\n                    </span>\r\n                    <span className=\"participant-count\">\r\n                        {participants.length} {participants.length === 1 ? 'participant' : 'participants'}\r\n                    </span>\r\n                </div>\r\n                <div className=\"navbar-actions\">\r\n                    <span className=\"user-welcome\">Welcome, {user?.username}!</span>\r\n                    <button className=\"leave-room-btn\" onClick={goBackToDashboard}>\r\n                        Leave Room\r\n                    </button>\r\n                    <button className=\"logout-btn\" onClick={onLogout}>\r\n                        Logout\r\n                    </button>\r\n                </div>\r\n            </nav>\r\n            {error && (\r\n                <div className=\"room-error-message\">\r\n                    {error}\r\n                    <button onClick={() => setError('')}>Ã—</button>\r\n                </div>\r\n            )}\r\n            <div className=\"room-content\">\r\n                <div className=\"room-main\">\r\n                    <VideoGrid\r\n                        localStream={localStream}\r\n                        remoteStreams={remoteStreams}\r\n                        participants={participants}\r\n                        currentUser={user}\r\n                        videoEnabled={videoEnabled}\r\n                        audioEnabled={audioEnabled}\r\n                        isHost={isHost}\r\n                        onKickParticipant={handleKickParticipant}\r\n                    />\r\n                    <RoomControls\r\n                        videoEnabled={videoEnabled}\r\n                        audioEnabled={audioEnabled}\r\n                        onToggleVideo={toggleVideo}\r\n                        onToggleAudio={toggleAudio}\r\n                        isHost={isHost}\r\n                        onStartWatchParty={handleStartWatchParty}\r\n                        loading={loading}\r\n                    />\r\n                </div>\r\n                <RoomSidebar\r\n                    roomCode={roomData?.roomCode}\r\n                    participants={participants}\r\n                    chatMessages={chatMessages}\r\n                    chatInput={chatInput}\r\n                    onChatInputChange={setChatInput}\r\n                    onSendMessage={sendChatMessage}\r\n                    onCopyLink={copyRoomLink}\r\n                    onShareWhatsApp={shareToWhatsApp}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\nexport default Room;"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AAC1D,SAASC,WAAW,EAAEC,WAAW,EAAEC,eAAe,QAAQ,kBAAkB;AAC5E,OAAOC,SAAS,MAAM,0BAA0B;AAChD,OAAOC,aAAa,MAAM,8BAA8B;AACxD,SAASC,MAAM,QAAQ,gBAAgB;AACvC,OAAOC,MAAM,MAAM,eAAe;AAClC,OAAOC,SAAS,MAAM,aAAa;AACnC,OAAOC,YAAY,MAAM,gBAAgB;AACzC,OAAOC,WAAW,MAAM,eAAe;AACvC,OAAO,uBAAuB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE/B,MAAMC,IAAI,GAAGA,CAAC;EAAEC,IAAI;EAAEC;AAAS,CAAC,KAAK;EAAAC,EAAA;EACjC,MAAM,CAACC,QAAQ,EAAEC,WAAW,CAAC,GAAGpB,QAAQ,CAAC,IAAI,CAAC;EAC9C,MAAM,CAACqB,MAAM,EAAEC,SAAS,CAAC,GAAGtB,QAAQ,CAAC,KAAK,CAAC;EAC3C,MAAM,CAACuB,YAAY,EAAEC,eAAe,CAAC,GAAGxB,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAACyB,aAAa,EAAEC,gBAAgB,CAAC,GAAG1B,QAAQ,CAAC,IAAI2B,GAAG,CAAC,CAAC,CAAC;EAC7D,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAG7B,QAAQ,CAAC,IAAI,CAAC;EACpD,MAAM,CAAC8B,YAAY,EAAEC,eAAe,CAAC,GAAG/B,QAAQ,CAAC,IAAI,CAAC;EACtD,MAAM,CAACgC,YAAY,EAAEC,eAAe,CAAC,GAAGjC,QAAQ,CAAC,IAAI,CAAC;EACtD,MAAM,CAACkC,YAAY,EAAEC,eAAe,CAAC,GAAGnC,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAACoC,SAAS,EAAEC,YAAY,CAAC,GAAGrC,QAAQ,CAAC,EAAE,CAAC;EAC9C,MAAM,CAACsC,OAAO,EAAEC,UAAU,CAAC,GAAGvC,QAAQ,CAAC,IAAI,CAAC;EAC5C,MAAM,CAACwC,KAAK,EAAEC,QAAQ,CAAC,GAAGzC,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAAC0C,WAAW,EAAEC,cAAc,CAAC,GAAG3C,QAAQ,CAAC,IAAI,CAAC;EACpD,MAAM,CAAC4C,WAAW,EAAEC,cAAc,CAAC,GAAG7C,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM8C,QAAQ,GAAG3C,WAAW,CAAC,CAAC;EAC9B,MAAM4C,QAAQ,GAAG3C,WAAW,CAAC,CAAC;EAC9B,MAAM,CAAC4C,YAAY,CAAC,GAAG3C,eAAe,CAAC,CAAC;EACxC,MAAM4C,iBAAiB,GAAG/C,MAAM,CAAC,KAAK,CAAC;EACvC,MAAMgD,cAAc,GAAGhD,MAAM,CAAC,IAAI,CAAC;EACnC,MAAMiD,eAAe,GAAGjD,MAAM,CAAC,EAAE,CAAC;EAClC,MAAMkD,WAAW,GAAGlD,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;;EAElCD,SAAS,CAAC,MAAM;IACZkD,eAAe,CAACE,OAAO,GAAG9B,YAAY;EAC1C,CAAC,EAAE,CAACA,YAAY,CAAC,CAAC;;EAElB;EACAtB,SAAS,CAAC,MAAM;IACZmD,WAAW,CAACC,OAAO,GAAGlC,QAAQ;EAClC,CAAC,EAAE,CAACA,QAAQ,CAAC,CAAC;EAEdlB,SAAS,CAAC,MAAM;IAAA,IAAAqD,eAAA,EAAAC,gBAAA;IACZ,MAAMC,QAAQ,GAAGR,YAAY,CAACS,GAAG,CAAC,MAAM,CAAC;IAEzC,IAAID,QAAQ,IAAI,CAACP,iBAAiB,CAACI,OAAO,IAAIrC,IAAI,EAAE;MAChDiC,iBAAiB,CAACI,OAAO,GAAG,IAAI;MAChCK,cAAc,CAACF,QAAQ,CAAC;MACxB;IACJ;IAEA,IAAI,GAAAF,eAAA,GAACP,QAAQ,CAACY,KAAK,cAAAL,eAAA,eAAdA,eAAA,CAAgBnC,QAAQ,KAAI,CAAC8B,iBAAiB,CAACI,OAAO,IAAI,CAACG,QAAQ,EAAE;MACtEV,QAAQ,CAAC,YAAY,CAAC;MACtB;IACJ;IAEA,IAAI,CAAAS,gBAAA,GAAAR,QAAQ,CAACY,KAAK,cAAAJ,gBAAA,eAAdA,gBAAA,CAAgBpC,QAAQ,IAAI,CAAC8B,iBAAiB,CAACI,OAAO,EAAE;MACxDJ,iBAAiB,CAACI,OAAO,GAAG,IAAI;MAChC,MAAMO,IAAI,GAAGb,QAAQ,CAACY,KAAK,CAACxC,QAAQ;MACpCC,WAAW,CAACwC,IAAI,CAAC;MACjBtC,SAAS,CAACsC,IAAI,CAACvC,MAAM,CAAC;MACtBwC,cAAc,CAACD,IAAI,CAAC;IACxB;IAEA,OAAO,MAAM;MACTE,OAAO,CAAC,CAAC;IACb,CAAC;EACL,CAAC,EAAE,CAACf,QAAQ,CAACY,KAAK,EAAEX,YAAY,EAAEhC,IAAI,CAAC,CAAC;EAExCf,SAAS,CAAC,MAAM;IACZ8D,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAEzC,YAAY,CAAC0C,GAAG,CAACC,CAAC,KAAK;MAAEC,EAAE,EAAED,CAAC,CAACC,EAAE;MAAEC,QAAQ,EAAEF,CAAC,CAACE;IAAS,CAAC,CAAC,CAAC,CAAC;IACxGL,OAAO,CAACC,GAAG,CAAC,6BAA6B,EAAEK,KAAK,CAACC,IAAI,CAAC7C,aAAa,CAAC8C,IAAI,CAAC,CAAC,CAAC,CAAC;IAC5ER,OAAO,CAACC,GAAG,CAAC,yBAAyB,EAAEhD,IAAI,CAACmD,EAAE,CAAC;EACnD,CAAC,EAAE,CAAC5C,YAAY,EAAEE,aAAa,EAAET,IAAI,CAAC,CAAC;EAEvC,MAAM0C,cAAc,GAAG,MAAOF,QAAQ,IAAK;IACvC,IAAI;MACAjB,UAAU,CAAC,IAAI,CAAC;MAChBwB,OAAO,CAACC,GAAG,CAAC,iCAAiC,EAAER,QAAQ,CAAC;MAExD,MAAMgB,QAAQ,GAAG,MAAMlE,SAAS,CAACmE,IAAI,CAAC,cAAcjB,QAAQ,OAAO,CAAC;MACpE,MAAMI,IAAI,GAAG;QACTJ,QAAQ,EAAEgB,QAAQ,CAACE,IAAI,CAAClB,QAAQ;QAChCmB,QAAQ,EAAEH,QAAQ,CAACE,IAAI,CAACC,QAAQ;QAChCtD,MAAM,EAAEmD,QAAQ,CAACE,IAAI,CAACrD;MAC1B,CAAC;MAED0C,OAAO,CAACC,GAAG,CAAC,oCAAoC,EAAEJ,IAAI,CAAC;;MAEvD;MACAxC,WAAW,CAACwC,IAAI,CAAC;MACjBtC,SAAS,CAACsC,IAAI,CAACvC,MAAM,CAAC;;MAEtB;MACA,MAAMwC,cAAc,CAACD,IAAI,CAAC;IAC9B,CAAC,CAAC,OAAOgB,GAAG,EAAE;MAAA,IAAAC,aAAA,EAAAC,kBAAA;MACVf,OAAO,CAACvB,KAAK,CAAC,qBAAqB,EAAEoC,GAAG,CAAC;MACzCnC,QAAQ,CAAC,EAAAoC,aAAA,GAAAD,GAAG,CAACJ,QAAQ,cAAAK,aAAA,wBAAAC,kBAAA,GAAZD,aAAA,CAAcH,IAAI,cAAAI,kBAAA,uBAAlBA,kBAAA,CAAoBC,OAAO,KAAI,qBAAqB,CAAC;MAC9DC,UAAU,CAAC,MAAMlC,QAAQ,CAAC,YAAY,CAAC,EAAE,IAAI,CAAC;IAClD;EACJ,CAAC;EAED,MAAMe,cAAc,GAAG,MAAOD,IAAI,IAAK;IACnC,IAAI;MACAG,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAEJ,IAAI,CAACJ,QAAQ,CAAC;;MAE1D;MACA,MAAMyB,eAAe,CAAC,CAAC;;MAEvB;MACA,MAAMC,gBAAgB,CAACtB,IAAI,CAACJ,QAAQ,CAAC;;MAErC;MACA,MAAM2B,gBAAgB,CAACvB,IAAI,CAAC;MAE5BwB,gBAAgB,CAAC,cAAcxB,IAAI,CAACe,QAAQ,GAAG,CAAC;IACpD,CAAC,CAAC,OAAOC,GAAG,EAAE;MACVb,OAAO,CAACvB,KAAK,CAAC,0BAA0B,EAAEoC,GAAG,CAAC;MAC9CnC,QAAQ,CAAC,2BAA2B,CAAC;IACzC,CAAC,SAAS;MACNF,UAAU,CAAC,KAAK,CAAC;IACrB;EACJ,CAAC;EAED,MAAM0C,eAAe,GAAG,MAAAA,CAAA,KAAY;IAChC,IAAI;MACA,MAAMI,MAAM,GAAG,MAAMC,SAAS,CAACC,YAAY,CAACC,YAAY,CAAC;QACrDC,KAAK,EAAE;UACHC,KAAK,EAAE;YAAEC,KAAK,EAAE;UAAK,CAAC;UACtBC,MAAM,EAAE;YAAED,KAAK,EAAE;UAAI,CAAC;UACtBE,UAAU,EAAE;QAChB,CAAC;QACDC,KAAK,EAAE;UACHC,gBAAgB,EAAE,IAAI;UACtBC,gBAAgB,EAAE,IAAI;UACtBC,eAAe,EAAE;QACrB;MACJ,CAAC,CAAC;MACF/C,cAAc,CAACG,OAAO,GAAGgC,MAAM;MAC/BxD,cAAc,CAACwD,MAAM,CAAC;MACtBtB,OAAO,CAACC,GAAG,CAAC,yCAAyC,CAAC;IAC1D,CAAC,CAAC,OAAOY,GAAG,EAAE;MACVb,OAAO,CAACvB,KAAK,CAAC,gCAAgC,EAAEoC,GAAG,CAAC;MACpDnC,QAAQ,CAAC,+DAA+D,CAAC;MACzE,MAAMmC,GAAG;IACb;EACJ,CAAC;EAED,MAAMO,gBAAgB,GAAIvB,IAAI,IAAK;IAC/B,OAAO,IAAIsC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACpC,MAAMC,MAAM,GAAG,IAAI5F,MAAM,CAAC,KAAK,CAAC;MAChC,MAAM6F,MAAM,GAAG,IAAI9F,MAAM,CAAC;QACtB+F,gBAAgB,EAAEA,CAAA,KAAMF,MAAM;QAC9BG,cAAc,EAAE,IAAI;QACpBC,iBAAiB,EAAE,IAAI;QACvBC,iBAAiB,EAAE,IAAI;QACvBC,SAAS,EAAEA,CAAA,KAAM;UACb5C,OAAO,CAACC,GAAG,CAAC,+BAA+B,CAAC;UAC5CsC,MAAM,CAACM,SAAS,CAAC,eAAehD,IAAI,CAACJ,QAAQ,EAAE,EAAGuB,OAAO,IAAK;YAC1D8B,sBAAsB,CAACC,IAAI,CAACC,KAAK,CAAChC,OAAO,CAACiC,IAAI,CAAC,CAAC;UACpD,CAAC,CAAC;UAEF,MAAMC,aAAa,GAAG/D,cAAc,CAACG,OAAO,IAAIzB,WAAW;UAC3DrB,aAAa,CAAC2G,UAAU,CAACZ,MAAM,EAAE1C,IAAI,CAACJ,QAAQ,EAAExC,IAAI,CAACmD,EAAE,EAAE8C,aAAa,CAAC;UACvE1G,aAAa,CAAC4G,cAAc,GAAGC,kBAAkB;UACjD7G,aAAa,CAAC8G,iBAAiB,GAAGC,2BAA2B;UAE7D3E,cAAc,CAAC2D,MAAM,CAAC;UACtBzD,cAAc,CAAC,IAAI,CAAC;UAEpBmC,UAAU,CAAC,MAAM;YACbjB,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAC;YAC/CzD,aAAa,CAACgH,UAAU,CAAC,CAAC;UAC9B,CAAC,EAAE,GAAG,CAAC;UAEPvC,UAAU,CAAC,MAAM;YACbjB,OAAO,CAACC,GAAG,CAAC,iDAAiD,CAAC;YAC9D,MAAMwD,mBAAmB,GAAGrE,eAAe,CAACE,OAAO;YACnDU,OAAO,CAACC,GAAG,CAAC,uCAAuC,EAC/CwD,mBAAmB,CAACvD,GAAG,CAACC,CAAC,IAAI,GAAGA,CAAC,CAACE,QAAQ,IAAIF,CAAC,CAACC,EAAE,GAAG,CAAC,CAAC;YAC3D,IAAIqD,mBAAmB,CAACC,MAAM,GAAG,CAAC,EAAE;cAChCC,yCAAyC,CAAC,CAAC;YAC/C,CAAC,MAAM;cACH3D,OAAO,CAACC,GAAG,CAAC,kDAAkD,CAAC;YACnE;UACJ,CAAC,EAAE,IAAI,CAAC;UACRmC,OAAO,CAAC,CAAC;QACb,CAAC;QACDwB,YAAY,EAAEA,CAAA,KAAM;UAChB5D,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAC;UAC/CnB,cAAc,CAAC,KAAK,CAAC;QACzB,CAAC;QACD+E,YAAY,EAAGpF,KAAK,IAAK;UACrBuB,OAAO,CAACvB,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;UACjD4D,MAAM,CAAC5D,KAAK,CAAC;QACjB;MACJ,CAAC,CAAC;MACF8D,MAAM,CAACuB,QAAQ,CAAC,CAAC;IACrB,CAAC,CAAC;EACN,CAAC;EAED,MAAMH,yCAAyC,GAAGA,CAAA,KAAM;IACpD,MAAMF,mBAAmB,GAAGrE,eAAe,CAACE,OAAO;IACnDU,OAAO,CAACC,GAAG,CAAC,6DAA6D,EACrEwD,mBAAmB,CAACvD,GAAG,CAACC,CAAC,IAAI,GAAGA,CAAC,CAACC,EAAE,IAAID,CAAC,CAACE,QAAQ,EAAE,CAAC,CAAC;IAE1D,IAAIoD,mBAAmB,CAACC,MAAM,KAAK,CAAC,EAAE;MAClC1D,OAAO,CAACC,GAAG,CAAC,0CAA0C,CAAC;MACvD;IACJ;IAEAwD,mBAAmB,CAACM,OAAO,CAACC,WAAW,IAAI;MACvC,MAAMC,gBAAgB,GAAGC,MAAM,CAACF,WAAW,CAAC5D,EAAE,CAAC;MAC/C,MAAM+D,gBAAgB,GAAGD,MAAM,CAACjH,IAAI,CAACmD,EAAE,CAAC;MAExC,IAAI6D,gBAAgB,KAAKE,gBAAgB,EAAE;QACvCnE,OAAO,CAACC,GAAG,CAAC,4CAA4C,EACpD+D,WAAW,CAAC3D,QAAQ,EAAE,GAAG,EAAE4D,gBAAgB,EAAE,GAAG,CAAC;QAErDzH,aAAa,CAAC4H,oBAAoB,CAACH,gBAAgB,CAAC,CAACI,IAAI,CAAC,MAAM;UAC5DrE,OAAO,CAACC,GAAG,CAAC,4DAA4D,EAAEgE,gBAAgB,CAAC;UAE3F,IAAIzH,aAAa,CAAC8H,wBAAwB,CAACH,gBAAgB,EAAEF,gBAAgB,CAAC,EAAE;YAC5EjE,OAAO,CAACC,GAAG,CAAC,iCAAiC,EAAEgE,gBAAgB,CAAC;YAChEhD,UAAU,CAAC,MAAM;cACbjB,OAAO,CAACC,GAAG,CAAC,mDAAmD,EAAEgE,gBAAgB,CAAC;cAClFzH,aAAa,CAAC+H,WAAW,CAACN,gBAAgB,CAAC;YAC/C,CAAC,EAAE,IAAI,CAAC;UACZ,CAAC,MAAM;YACHjE,OAAO,CAACC,GAAG,CAAC,sCAAsC,EAAEgE,gBAAgB,CAAC;UACzE;QACJ,CAAC,CAAC,CAACO,KAAK,CAAC/F,KAAK,IAAI;UACduB,OAAO,CAACvB,KAAK,CAAC,mEAAmE,EAAEA,KAAK,CAAC;QAC7F,CAAC,CAAC;MACN;IACJ,CAAC,CAAC;EACN,CAAC;EAED,MAAMqE,sBAAsB,GAAG,MAAO2B,YAAY,IAAK;IACnD,MAAM;MAAEC,IAAI;MAAE1D,OAAO;MAAE2D;IAAO,CAAC,GAAGF,YAAY;IAC9CzE,OAAO,CAACC,GAAG,CAAC,uCAAuC,EAAEyE,IAAI,EAAE,SAAS,EAAEC,MAAM,EAAE,cAAc,EAAE1H,IAAI,CAACmD,EAAE,CAAC;IAEtG,QAAQsE,IAAI;MACR,KAAK,aAAa;QACdrD,gBAAgB,CAACL,OAAO,CAAC;QAEzB,MAAM4D,mBAAmB,GAAG,MAAMC,mBAAmB,CAAC,CAAC;QACvD7E,OAAO,CAACC,GAAG,CAAC,uCAAuC,EAAE2E,mBAAmB,CAAC1E,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACC,EAAE,CAAC,CAAC;QAExF,IAAIuE,MAAM,IAAIT,MAAM,CAACS,MAAM,CAAC,KAAKT,MAAM,CAACjH,IAAI,CAACmD,EAAE,CAAC,EAAE;UAC9CJ,OAAO,CAACC,GAAG,CAAC,sDAAsD,EAAE0E,MAAM,CAAC;UAE3E,IAAI9F,WAAW,EAAE;YACboC,UAAU,CAAC,MAAM;cACbjB,OAAO,CAACC,GAAG,CAAC,mDAAmD,EAAE0E,MAAM,CAAC;cACxEnI,aAAa,CAACsI,UAAU,CAACH,MAAM,CAAC;YACpC,CAAC,EAAE,GAAG,CAAC;UACX,CAAC,MAAM;YACH3E,OAAO,CAAC+E,IAAI,CAAC,qDAAqD,CAAC;YACnE9D,UAAU,CAAC,MAAM;cACb,IAAIpC,WAAW,EAAE;gBACbmB,OAAO,CAACC,GAAG,CAAC,iDAAiD,EAAE0E,MAAM,CAAC;gBACtEnI,aAAa,CAACsI,UAAU,CAACH,MAAM,CAAC;cACpC;YACJ,CAAC,EAAE,IAAI,CAAC;UACZ;QACJ;QACA;MACJ,KAAK,WAAW;MAChB,KAAK,aAAa;QACd,MAAME,mBAAmB,CAAC,CAAC;QAC3BxD,gBAAgB,CAACL,OAAO,CAAC;QACzB;MACJ,KAAK,eAAe;QAChB,MAAM6D,mBAAmB,CAAC,CAAC;QAC3B;MACJ,KAAK,YAAY;QACbxD,gBAAgB,CAACL,OAAO,CAAC;QACzBC,UAAU,CAAC,MAAM+D,iBAAiB,CAAC,CAAC,EAAE,IAAI,CAAC;QAC3C;MACJ;QACIhF,OAAO,CAACC,GAAG,CAAC,qCAAqC,EAAEyE,IAAI,CAAC;QACxD;IACR;EACJ,CAAC;EAED,MAAMrB,kBAAkB,GAAGA,CAAC4B,aAAa,EAAE3D,MAAM,KAAK;IAClD,MAAM2C,gBAAgB,GAAGC,MAAM,CAACe,aAAa,CAAC;IAC9CjF,OAAO,CAACC,GAAG,CAAC,0CAA0C,EAAEgE,gBAAgB,CAAC;IACzEjE,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAEqB,MAAM,CAAC4D,SAAS,CAAC,CAAC,CAAChF,GAAG,CAACiF,CAAC,KAAK;MAAEC,IAAI,EAAED,CAAC,CAACC,IAAI;MAAEC,OAAO,EAAEF,CAAC,CAACE;IAAQ,CAAC,CAAC,CAAC,CAAC;IAC5GrF,OAAO,CAACC,GAAG,CAAC,iCAAiC,EAAEzC,YAAY,CAAC0C,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACC,EAAE,CAAC,CAAC;IAE3E,MAAMkF,iBAAiB,GAAG9H,YAAY,CAAC+H,IAAI,CAACpF,CAAC,IAAI+D,MAAM,CAAC/D,CAAC,CAACC,EAAE,CAAC,KAAK6D,gBAAgB,CAAC;IACnFjE,OAAO,CAACC,GAAG,CAAC,uCAAuC,EAAEqF,iBAAiB,CAAC;IAEvE3H,gBAAgB,CAAC6H,IAAI,IAAI;MACrB,MAAMC,UAAU,GAAG,IAAI7H,GAAG,CAAC4H,IAAI,CAAC;MAChCC,UAAU,CAACC,GAAG,CAACzB,gBAAgB,EAAE3C,MAAM,CAAC;MACxCtB,OAAO,CAACC,GAAG,CAAC,gDAAgD,EAAEK,KAAK,CAACC,IAAI,CAACkF,UAAU,CAACjF,IAAI,CAAC,CAAC,CAAC,CAAC;MAC5F,OAAOiF,UAAU;IACrB,CAAC,CAAC;EACN,CAAC;EAED,MAAMlC,2BAA2B,GAAI0B,aAAa,IAAK;IACnDjF,OAAO,CAACC,GAAG,CAAC,mDAAmD,EAAEgF,aAAa,CAAC;IAC/EtH,gBAAgB,CAAC6H,IAAI,IAAI;MACrB,MAAMC,UAAU,GAAG,IAAI7H,GAAG,CAAC4H,IAAI,CAAC;MAChCC,UAAU,CAACE,MAAM,CAACV,aAAa,CAAC;MAChC,OAAOQ,UAAU;IACrB,CAAC,CAAC;EACN,CAAC;EAED,MAAMtE,gBAAgB,GAAG,MAAO1B,QAAQ,IAAK;IACzC,IAAI;MACAO,OAAO,CAACC,GAAG,CAAC,0CAA0C,EAAER,QAAQ,CAAC;MACjE,MAAMgB,QAAQ,GAAG,MAAMlE,SAAS,CAACmD,GAAG,CAAC,cAAcD,QAAQ,eAAe,CAAC;MAC3E,MAAMmG,kBAAkB,GAAGnF,QAAQ,CAACE,IAAI,CAACnD,YAAY;MACrDwC,OAAO,CAACC,GAAG,CAAC,+BAA+B,EAAE2F,kBAAkB,CAAC1F,GAAG,CAACC,CAAC,KAAK;QAAEC,EAAE,EAAED,CAAC,CAACC,EAAE;QAAEC,QAAQ,EAAEF,CAAC,CAACE;MAAS,CAAC,CAAC,CAAC,CAAC;MAC/G5C,eAAe,CAACmI,kBAAkB,CAAC;MACnC,OAAOA,kBAAkB;IAC7B,CAAC,CAAC,OAAO/E,GAAG,EAAE;MACVb,OAAO,CAACvB,KAAK,CAAC,uCAAuC,EAAEoC,GAAG,CAAC;MAC3D,OAAO,EAAE;IACb;EACJ,CAAC;EAED,MAAMgE,mBAAmB,GAAG,MAAAA,CAAA,KAAY;IACpC;IACA,MAAMgB,eAAe,GAAGxG,WAAW,CAACC,OAAO;IAC3C,IAAIuG,eAAe,IAAIA,eAAe,CAACpG,QAAQ,EAAE;MAC7CO,OAAO,CAACC,GAAG,CAAC,6CAA6C,EAAE4F,eAAe,CAACpG,QAAQ,CAAC;MACpF,OAAO,MAAM0B,gBAAgB,CAAC0E,eAAe,CAACpG,QAAQ,CAAC;IAC3D,CAAC,MAAM;MACHO,OAAO,CAACvB,KAAK,CAAC,8DAA8D,CAAC;MAC7E,OAAO,EAAE;IACb;EACJ,CAAC;EAED,MAAMqH,WAAW,GAAG,MAAAA,CAAA,KAAY;IAC5B,MAAMC,aAAa,GAAG,CAAChI,YAAY;IACnCC,eAAe,CAAC+H,aAAa,CAAC;IAE9B,IAAI5G,cAAc,CAACG,OAAO,EAAE;MACxB,MAAM0G,WAAW,GAAG7G,cAAc,CAACG,OAAO,CAAC2G,cAAc,CAAC,CAAC;MAC3DD,WAAW,CAACjC,OAAO,CAACmC,KAAK,IAAI;QACzBA,KAAK,CAACb,OAAO,GAAGU,aAAa;MACjC,CAAC,CAAC;MACFvJ,aAAa,CAAC2J,WAAW,CAAC,OAAO,EAAEJ,aAAa,CAAC;IACrD;IAEA,IAAI;MACA,IAAI3I,QAAQ,IAAIA,QAAQ,CAACqC,QAAQ,EAAE;QAC/B,MAAMlD,SAAS,CAACmE,IAAI,CAAC,cAActD,QAAQ,CAACqC,QAAQ,QAAQ,EAAE;UAC1D1B,YAAY,EAAEgI,aAAa;UAC3B9H,YAAY,EAAEA;QAClB,CAAC,CAAC;MACN;IACJ,CAAC,CAAC,OAAO4C,GAAG,EAAE;MACVb,OAAO,CAACvB,KAAK,CAAC,gCAAgC,EAAEoC,GAAG,CAAC;IACxD;EACJ,CAAC;EAED,MAAMuF,WAAW,GAAG,MAAAA,CAAA,KAAY;IAC5B,MAAMC,aAAa,GAAG,CAACpI,YAAY;IACnCC,eAAe,CAACmI,aAAa,CAAC;IAE9B,IAAIlH,cAAc,CAACG,OAAO,EAAE;MACxB,MAAMgH,WAAW,GAAGnH,cAAc,CAACG,OAAO,CAACiH,cAAc,CAAC,CAAC;MAC3DD,WAAW,CAACvC,OAAO,CAACmC,KAAK,IAAI;QACzBA,KAAK,CAACb,OAAO,GAAGgB,aAAa;MACjC,CAAC,CAAC;MACF7J,aAAa,CAAC2J,WAAW,CAAC,OAAO,EAAEE,aAAa,CAAC;IACrD;IAEA,IAAI;MACA,IAAIjJ,QAAQ,IAAIA,QAAQ,CAACqC,QAAQ,EAAE;QAC/B,MAAMlD,SAAS,CAACmE,IAAI,CAAC,cAActD,QAAQ,CAACqC,QAAQ,QAAQ,EAAE;UAC1D1B,YAAY,EAAEA,YAAY;UAC1BE,YAAY,EAAEoI;QAClB,CAAC,CAAC;MACN;IACJ,CAAC,CAAC,OAAOxF,GAAG,EAAE;MACVb,OAAO,CAACvB,KAAK,CAAC,gCAAgC,EAAEoC,GAAG,CAAC;IACxD;EACJ,CAAC;EAED,MAAM2F,eAAe,GAAGA,CAAA,KAAM;IAC1B,IAAI,CAACnI,SAAS,CAACoI,IAAI,CAAC,CAAC,EAAE;IAEvB,MAAMzF,OAAO,GAAG;MACZZ,EAAE,EAAEsG,IAAI,CAACC,GAAG,CAAC,CAAC;MACdjC,IAAI,EAAE,MAAM;MACZrE,QAAQ,EAAEpD,IAAI,CAACoD,QAAQ;MACvBW,OAAO,EAAE3C,SAAS;MAClBuI,SAAS,EAAE,IAAIF,IAAI,CAAC,CAAC,CAACG,kBAAkB,CAAC;IAC7C,CAAC;IACDzI,eAAe,CAACoH,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAExE,OAAO,CAAC,CAAC;IAC3C1C,YAAY,CAAC,EAAE,CAAC;EACpB,CAAC;EAED,MAAM+C,gBAAgB,GAAIL,OAAO,IAAK;IAClC5C,eAAe,CAACoH,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;MAC9BpF,EAAE,EAAEsG,IAAI,CAACC,GAAG,CAAC,CAAC;MACdjC,IAAI,EAAE,QAAQ;MACd1D,OAAO;MACP4F,SAAS,EAAE,IAAIF,IAAI,CAAC,CAAC,CAACG,kBAAkB,CAAC;IAC7C,CAAC,CAAC,CAAC;EACP,CAAC;EAED,MAAMC,YAAY,GAAGA,CAAA,KAAM;IACvB,MAAMC,IAAI,GAAG,GAAGC,MAAM,CAAChI,QAAQ,CAACiI,MAAM,UAAU7J,QAAQ,CAACqC,QAAQ,EAAE;IACnE8B,SAAS,CAAC2F,SAAS,CAACC,SAAS,CAACJ,IAAI,CAAC;IACnCK,KAAK,CAAC,gCAAgC,CAAC;EAC3C,CAAC;EAED,MAAMC,eAAe,GAAGA,CAAA,KAAM;IAC1B,MAAMN,IAAI,GAAG,GAAGC,MAAM,CAAChI,QAAQ,CAACiI,MAAM,UAAU7J,QAAQ,CAACqC,QAAQ,EAAE;IACnE,MAAMuB,OAAO,GAAG,6CAA6C5D,QAAQ,CAACqC,QAAQ,KAAKsH,IAAI,EAAE;IACzFC,MAAM,CAACM,IAAI,CAAC,uBAAuBC,kBAAkB,CAACvG,OAAO,CAAC,EAAE,EAAE,QAAQ,CAAC;EAC/E,CAAC;EAED,MAAMwG,qBAAqB,GAAG,MAAAA,CAAA,KAAY;IACtC,IAAI;MACAhJ,UAAU,CAAC,IAAI,CAAC;MAChB,IAAIpB,QAAQ,IAAIA,QAAQ,CAACqC,QAAQ,EAAE;QAC/B,MAAMlD,SAAS,CAACmE,IAAI,CAAC,cAActD,QAAQ,CAACqC,QAAQ,QAAQ,CAAC;QAC7D4B,gBAAgB,CAAC,yBAAyB,CAAC;MAC/C;IACJ,CAAC,CAAC,OAAOR,GAAG,EAAE;MAAA,IAAA4G,cAAA,EAAAC,mBAAA;MACVhJ,QAAQ,CAAC,EAAA+I,cAAA,GAAA5G,GAAG,CAACJ,QAAQ,cAAAgH,cAAA,wBAAAC,mBAAA,GAAZD,cAAA,CAAc9G,IAAI,cAAA+G,mBAAA,uBAAlBA,mBAAA,CAAoB1G,OAAO,KAAI,6BAA6B,CAAC;IAC1E,CAAC,SAAS;MACNxC,UAAU,CAAC,KAAK,CAAC;IACrB;EACJ,CAAC;EAED,MAAMmJ,qBAAqB,GAAG,MAAO1C,aAAa,IAAK;IACnD,IAAI;MACA,IAAI7H,QAAQ,IAAIA,QAAQ,CAACqC,QAAQ,EAAE;QAC/B,MAAMlD,SAAS,CAACmE,IAAI,CAAC,cAActD,QAAQ,CAACqC,QAAQ,SAASwF,aAAa,EAAE,CAAC;MACjF;IACJ,CAAC,CAAC,OAAOpE,GAAG,EAAE;MAAA,IAAA+G,cAAA,EAAAC,mBAAA;MACVnJ,QAAQ,CAAC,EAAAkJ,cAAA,GAAA/G,GAAG,CAACJ,QAAQ,cAAAmH,cAAA,wBAAAC,mBAAA,GAAZD,cAAA,CAAcjH,IAAI,cAAAkH,mBAAA,uBAAlBA,mBAAA,CAAoB7G,OAAO,KAAI,4BAA4B,CAAC;IACzE;EACJ,CAAC;EAED,MAAMgE,iBAAiB,GAAG,MAAAA,CAAA,KAAY;IAClC,MAAMjF,OAAO,CAAC,CAAC;IACfhB,QAAQ,CAAC,YAAY,CAAC;EAC1B,CAAC;EAED,MAAMgB,OAAO,GAAG,MAAAA,CAAA,KAAY;IACxBC,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAC;IACzC,IAAId,cAAc,CAACG,OAAO,EAAE;MACxBH,cAAc,CAACG,OAAO,CAAC4F,SAAS,CAAC,CAAC,CAACnB,OAAO,CAACmC,KAAK,IAAIA,KAAK,CAAC4B,IAAI,CAAC,CAAC,CAAC;MACjE3I,cAAc,CAACG,OAAO,GAAG,IAAI;IACjC;IACA,IAAIzB,WAAW,EAAE;MACbA,WAAW,CAACqH,SAAS,CAAC,CAAC,CAACnB,OAAO,CAACmC,KAAK,IAAIA,KAAK,CAAC4B,IAAI,CAAC,CAAC,CAAC;IAC1D;IACAtL,aAAa,CAACuD,OAAO,CAAC,CAAC;IACvB,IAAIpB,WAAW,EAAE;MACbA,WAAW,CAACoJ,UAAU,CAAC,CAAC;IAC5B;;IAEA;IACA,MAAMlC,eAAe,GAAGxG,WAAW,CAACC,OAAO;IAC3C,IAAIuG,eAAe,IAAIA,eAAe,CAACpG,QAAQ,EAAE;MAC7C,IAAI;QACA,MAAMlD,SAAS,CAACmE,IAAI,CAAC,cAAcmF,eAAe,CAACpG,QAAQ,QAAQ,CAAC;MACxE,CAAC,CAAC,OAAOoB,GAAG,EAAE;QACVb,OAAO,CAACvB,KAAK,CAAC,uBAAuB,EAAEoC,GAAG,CAAC;MAC/C;IACJ;EACJ,CAAC;EAED,IAAItC,OAAO,EAAE;IACT,oBACIxB,OAAA;MAAKiL,SAAS,EAAC,cAAc;MAAAC,QAAA,gBACzBlL,OAAA;QAAKiL,SAAS,EAAC;MAAiB;QAAAE,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAM,CAAC,eACvCtL,OAAA;QAAAkL,QAAA,EAAG;MAAoB;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC1B,CAAC;EAEd;EAEA,oBACItL,OAAA;IAAKiL,SAAS,EAAC,gBAAgB;IAAAC,QAAA,gBAC3BlL,OAAA;MAAKiL,SAAS,EAAC,aAAa;MAAAC,QAAA,gBACxBlL,OAAA;QAAKiL,SAAS,EAAC,cAAc;QAAAC,QAAA,GAAC,WACjB,EAAC7K,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEwD,QAAQ;MAAA;QAAAsH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC3B,CAAC,eACNtL,OAAA;QAAKiL,SAAS,EAAC,aAAa;QAAAC,QAAA,gBACxBlL,OAAA;UAAMiL,SAAS,EAAC,mBAAmB;UAAAC,QAAA,GAAC,QAC1B,eAAAlL,OAAA;YAAAkL,QAAA,EAAS7K,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEqC;UAAQ;YAAAyI,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAS,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACzC,CAAC,eACPtL,OAAA;UAAMiL,SAAS,EAAC,mBAAmB;UAAAC,QAAA,GAC9BzK,YAAY,CAACkG,MAAM,EAAC,GAAC,EAAClG,YAAY,CAACkG,MAAM,KAAK,CAAC,GAAG,aAAa,GAAG,cAAc;QAAA;UAAAwE,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC/E,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACN,CAAC,eACNtL,OAAA;QAAKiL,SAAS,EAAC,gBAAgB;QAAAC,QAAA,gBAC3BlL,OAAA;UAAMiL,SAAS,EAAC,cAAc;UAAAC,QAAA,GAAC,WAAS,EAAChL,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEoD,QAAQ,EAAC,GAAC;QAAA;UAAA6H,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC,eAChEtL,OAAA;UAAQiL,SAAS,EAAC,gBAAgB;UAACM,OAAO,EAAEtD,iBAAkB;UAAAiD,QAAA,EAAC;QAE/D;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,eACTtL,OAAA;UAAQiL,SAAS,EAAC,YAAY;UAACM,OAAO,EAAEpL,QAAS;UAAA+K,QAAA,EAAC;QAElD;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACR,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACL,CAAC,EACL5J,KAAK,iBACF1B,OAAA;MAAKiL,SAAS,EAAC,oBAAoB;MAAAC,QAAA,GAC9BxJ,KAAK,eACN1B,OAAA;QAAQuL,OAAO,EAAEA,CAAA,KAAM5J,QAAQ,CAAC,EAAE,CAAE;QAAAuJ,QAAA,EAAC;MAAC;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC9C,CACR,eACDtL,OAAA;MAAKiL,SAAS,EAAC,cAAc;MAAAC,QAAA,gBACzBlL,OAAA;QAAKiL,SAAS,EAAC,WAAW;QAAAC,QAAA,gBACtBlL,OAAA,CAACJ,SAAS;UACNkB,WAAW,EAAEA,WAAY;UACzBH,aAAa,EAAEA,aAAc;UAC7BF,YAAY,EAAEA,YAAa;UAC3B+K,WAAW,EAAEtL,IAAK;UAClBc,YAAY,EAAEA,YAAa;UAC3BE,YAAY,EAAEA,YAAa;UAC3BX,MAAM,EAAEA,MAAO;UACfkL,iBAAiB,EAAEb;QAAsB;UAAAO,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC5C,CAAC,eACFtL,OAAA,CAACH,YAAY;UACTmB,YAAY,EAAEA,YAAa;UAC3BE,YAAY,EAAEA,YAAa;UAC3BwK,aAAa,EAAE3C,WAAY;UAC3B4C,aAAa,EAAEtC,WAAY;UAC3B9I,MAAM,EAAEA,MAAO;UACfqL,iBAAiB,EAAEnB,qBAAsB;UACzCjJ,OAAO,EAAEA;QAAQ;UAAA2J,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACpB,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACD,CAAC,eACNtL,OAAA,CAACF,WAAW;QACR4C,QAAQ,EAAErC,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEqC,QAAS;QAC7BjC,YAAY,EAAEA,YAAa;QAC3BW,YAAY,EAAEA,YAAa;QAC3BE,SAAS,EAAEA,SAAU;QACrBuK,iBAAiB,EAAEtK,YAAa;QAChCuK,aAAa,EAAErC,eAAgB;QAC/BsC,UAAU,EAAEhC,YAAa;QACzBiC,eAAe,EAAE1B;MAAgB;QAAAa,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACpC,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACD,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACL,CAAC;AAEd,CAAC;AAAClL,EAAA,CA1hBIH,IAAI;EAAA,QAcWZ,WAAW,EACXC,WAAW,EACLC,eAAe;AAAA;AAAA0M,EAAA,GAhBpChM,IAAI;AA2hBV,eAAeA,IAAI;AAAC,IAAAgM,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}